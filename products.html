<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buy The Device — complexfour</title>
  <meta name="description" content="complexfour hydrogen inhalation device for general wellness use. Secure checkout via Stripe. No medical claims." />
  <link rel="stylesheet" href="/assets/style.css" />

  <!-- PDP-only styles (keeps your global CSS clean). Move into style.css later if you want. -->
  <style>
    .pdp { padding-top: 14px; padding-bottom: 60px; }
    .breadcrumbs { font-size: 12px; color: var(--muted); margin: 6px 0 14px; }
    .breadcrumbs a { text-decoration: underline; text-decoration-color: rgba(20,23,26,.25); }
    .pdp-grid { display: grid; grid-template-columns: 1.05fr .95fr; gap: 18px; align-items: start; }
    @media (max-width: 920px){ .pdp-grid { grid-template-columns: 1fr; } }

    .gallery { border: 1px solid var(--border); border-radius: var(--radius); background: rgba(255,255,255,.92); box-shadow: var(--shadow-sm); overflow: hidden; }
    .gallery-main { aspect-ratio: 4 / 3; display: grid; place-items: center; background: linear-gradient(180deg, rgba(255,243,214,.55), rgba(255,255,255,.90)); }
    .gallery-main img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .gallery-main .placeholder { padding: 34px 18px; text-align: center; color: var(--muted); }

    .thumbs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 12px; border-top: 1px solid var(--border); background: rgba(255,255,255,.88); }
    .thumb { border: 1px solid var(--border); border-radius: 12px; background: rgba(255,255,255,.85); aspect-ratio: 1 / 1; display: grid; place-items: center; overflow: hidden; cursor: pointer; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .thumb.active { outline: 2px solid rgba(37,99,235,.35); border-color: rgba(37,99,235,.25); }

    .buybox { border: 1px solid var(--border); border-radius: var(--radius); background: rgba(255,255,255,.92); box-shadow: var(--shadow-md); padding: 16px; }
    .kicker { font-size: 12px; letter-spacing: .08em; text-transform: uppercase; color: rgba(20,23,26,.60); margin: 0 0 10px; }
    .pdp-title { margin: 0 0 8px; letter-spacing: -.02em; }
    .pdp-sub { margin: 0 0 12px; color: var(--muted); line-height: 1.55; }

    .price-row { display: flex; align-items: baseline; justify-content: space-between; gap: 10px; margin: 12px 0 10px; padding: 12px; border: 1px solid var(--border); border-radius: 14px; background: rgba(255,255,255,.85); }
    .price-big { font-size: 22px; font-weight: 850; letter-spacing: .2px; }
    .stock { font-size: 12px; color: rgba(7,88,87,.95); background: var(--accent-soft); border: 1px solid rgba(14,165,164,.22); padding: 6px 10px; border-radius: 999px; }

    .buy-actions { display: grid; gap: 10px; margin-top: 10px; }
    .trust { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px; margin-top: 12px; }
    @media (max-width: 520px){ .trust { grid-template-columns: 1fr; } }
    .trust-item { border: 1px solid var(--border); border-radius: 14px; padding: 10px 12px; background: rgba(255,255,255,.86); }
    .trust-item strong { display: block; font-size: 13px; }
    .trust-item span { display: block; font-size: 12px; color: var(--muted); margin-top: 2px; line-height: 1.35; }

    .bullets { margin: 10px 0 0; padding-left: 18px; color: var(--text); }
    .bullets li { margin: 6px 0; }

    .pdp-sections { margin-top: 18px; display: grid; gap: 14px; }
    details.accordion { border: 1px solid var(--border); border-radius: var(--radius); background: rgba(255,255,255,.90); box-shadow: var(--shadow-sm); overflow: hidden; }
    details.accordion summary { list-style: none; cursor: pointer; padding: 14px 16px; display: flex; align-items: center; justify-content: space-between; gap: 10px; font-weight: 750; }
    details.accordion summary::-webkit-details-marker { display: none; }
    details.accordion .content { padding: 0 16px 16px; color: var(--muted); line-height: 1.6; }
    .divider { height: 1px; background: var(--border); margin: 0 16px 14px; }

    .compare { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
    @media (max-width: 920px){ .compare { grid-template-columns: 1fr; } }
    .compare .card { padding: 14px; }
    .pill { display: inline-block; font-size: 12px; padding: 5px 10px; border-radius: 999px; border: 1px solid var(--border); background: rgba(255,255,255,.85); color: var(--muted); }

    .sticky-buy { position: sticky; top: 92px; }
    @media (max-width: 920px){ .sticky-buy { position: static; } }
  </style>
</head>

<body>
  <header class="header">
    <div class="container header-inner">
      <a class="brandwrap" href="/">
        <img class="logo" src="/assets/logo.svg" alt="complexfour logo" />
        <div class="brandtext">
          <div class="brandname">complexfour</div>
          <div class="brandsub">Molecular Hydrogen • Wellness</div>
        </div>
      </a>

      <nav class="nav">
        <a class="navlink active" href="/products.html">Buy The Device</a>
        <a class="navlink" href="/about-hydrogen.html">About Hydrogen Inhalation</a>
        <a class="navlink" href="/about-complex-four.html">About Complex Four</a>
        <a class="navlink" href="/support.html">Support</a>
      </nav>

      <div class="actions">
        <select id="currencySelect" class="select" aria-label="Currency">
          <option value="GBP">GBP (£)</option>
          <option value="EUR">EUR (€)</option>
          <option value="USD">USD ($)</option>
        </select>
        <button id="cartBtn" class="button secondary">
          Cart (<span id="cartCount">0</span>)
        </button>
      </div>
    </div>
  </header>

  <main class="container pdp">
    <div class="breadcrumbs">
      <a href="/">Home</a> <span aria-hidden="true">›</span> <span>Buy The Device</span>
    </div>

    <div class="pdp-grid">
      <!-- LEFT: Gallery -->
      <section class="gallery" aria-label="Product images">
        <div class="gallery-main" id="galleryMain">
          <div class="placeholder">
            <strong>Loading image…</strong><br/>
            <span class="fineprint">This will use <code>image_url</code> from <code>/data/products.json</code>.</span>
          </div>
        </div>

        <div class="thumbs" id="thumbs">
  <button class="thumb active" type="button"
          data-src="/assets/device.jpg"
          aria-label="Main image">
    <img src="/assets/device.jpg" alt="Hydrogen unit main view">
  </button>

  <button class="thumb" type="button"
          data-src="/assets/device-2.jpg"
          aria-label="Angle view">
    <img src="/assets/device-2.jpg" alt="Hydrogen unit angle view">
  </button>

  <button class="thumb" type="button"
          data-src="/assets/device-3.jpg"
          aria-label="In use">
    <img src="/assets/device-3.jpg" alt="Hydrogen unit in use">
  </button>

  <button class="thumb" type="button"
          data-src="/assets/device-4.jpg"
          aria-label="Accessories">
    <img src="/assets/device-4.jpg" alt="Hydrogen unit accessories">
  </button>
</div>
</section>

      <!-- RIGHT: Buy box -->
      <aside class="buybox sticky-buy" aria-label="Purchase options">
        <h1 class="pdp-title" id="pdpTitle">Hydrogen Wellness Inhalation Unit</h1>
        <p class="pdp-sub" id="pdpDesc">
          A molecular hydrogen inhalation device intended for general wellness use. No medical claims are made.
        </p>

        <div class="price-row">
          <div>
            <div class="muted" style="font-size:12px;margin-bottom:4px;">Price shown in selected currency</div>
            <div class="price-big" id="pdpPrice">Loading…</div>
          </div>
          <div class="stock" aria-label="Availability">In stock</div>
        </div>

        <div class="buy-actions">
          <button id="pdpAddToCart" class="button">Add to cart</button>
          <button id="pdpBuyNow" class="button secondary">Buy now</button>
          <p class="fineprint">
            Checkout is handled securely by Stripe. Shipping address and contact details are collected during checkout.
          </p>
        </div>

        <div class="trust" aria-label="Trust and logistics">
          <div class="trust-item">
            <strong>Secure checkout</strong>
            <span>Stripe-hosted payment flow.</span>
          </div>
          <div class="trust-item">
            <strong>Fast setup</strong>
            <span>Designed for a simple daily routine.</span>
          </div>
          <div class="trust-item">
            <strong>Convenient</strong>
            <span>At-home wellness device.</span>
          </div>
        </div>

        <ul class="bullets" id="pdpHighlights" aria-label="Key highlights">
          <li>Designed for simple daily use</li>
          <li>Antioxidant capacity</li>
          <li>99.9% purity hydrogen</li>
        </ul>
      </aside>
    </div>

    <!-- Below-the-fold content -->
    <section class="pdp-sections" aria-label="Product information">
      <details class="accordion" open>
        <summary>
          What’s included
          <span class="pill">In the box</span>
        </summary>
        <div class="divider"></div>
        <div class="content">
          <ul class="bullets" id="pdpIncludes">
            <li>Hydrogen inhalation unit and accessories</li>
            <li>Power supply</li>
            <li>Quick-start guide</li>
            <li>Carrier for portability</li>
          </ul>
        </div>
      </details>

      <details class="accordion">
        <summary>
          How to use
          <span class="pill">Simple routine</span>
        </summary>
        <div class="divider"></div>
        <div class="content">
          <p>
            Many users start with short, consistent sessions and adjust over time based on comfort and goals.
            A common consumer wellness starting point is <strong>20–30 minutes</strong> once daily, then reassess.
          </p>
          <ul class="bullets">
            <li>Use in a well-ventilated space.</li>
            <li>Follow the device instructions and safety guidance.</li>
            <li>If you have a medical condition or use oxygen therapy, consult a clinician before use.</li>
          </ul>
          <p class="fineprint">
            Educational content only — not medical advice. Individual experiences vary and research is ongoing.
          </p>
        </div>
      </details>

      <details class="accordion">
        <summary>
          Shipping & returns
          <span class="pill">UK / EU / US</span>
        </summary>
        <div class="divider"></div>
        <div class="content">
          <p>
            Shipping costs and delivery estimates are calculated at checkout based on your address.
            Returns are accepted in line with our policy (see Terms/Returns).
          </p>
          <ul class="bullets">
            <li>Tracking provided where available.</li>
            <li>If an item arrives damaged, contact support promptly.</li>
          </ul>
        </div>
      </details>

      <details class="accordion">
        <summary>
          FAQ
          <span class="pill">Answers</span>
        </summary>
        <div class="divider"></div>
        <div class="content" id="pdpFaq">
          <p><strong>Is hydrogen inhalation safe?</strong><br/>
            Safety depends on concentration, device design, ventilation, and correct use. Always follow device instructions and use in a well-ventilated environment.
          </p>
        </div>
      </details>
    </section>

    <section class="section" aria-label="Why complexfour">
      <div class="section-head">
        <h2>Why complexfour</h2>
        <p class="muted">A calmer, more credible approach to hydrogen wellness.</p>
      </div>

      <div class="compare">
        <div class="card">
          <div class="badge">Education-first</div>
          <h4>Clear, careful language</h4>
          <p>You’ll find practical guidance and responsible disclaimers.</p>
        </div>
        <div class="card">
          <div class="badge">Simple checkout</div>
          <h4>Stripe-secure payments</h4>
          <p>Fast purchase flow with shipping/contact collected safely during checkout.</p>
        </div>
        <div class="card">
          <div class="badge">Single product focus</div>
          <h4>One device, done well</h4>
          <p>Instead of dozens of products, we believe in delivering a single, affordable, quality product.</p>
        </div>
      </div>
    </section>

    <section class="section notice">
      <h3>Medical disclaimer</h3>
      <p class="muted">
        Information on this site is for general educational purposes only and is not medical advice.
        Products are not intended to diagnose, treat, cure, or prevent any disease.
        If you have a medical condition, consult a qualified clinician before use.
      </p>
    </section>
  </main>

  <!-- Cart dialog (unchanged) -->
  <dialog id="cartDialog" class="dialog">
    <div class="dialog-header">
      <h3>Your cart</h3>
      <button id="closeCart" class="button secondary">Close</button>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer">
      <div class="row">
        <strong>Total</strong>
        <strong id="cartTotal">Calculated at checkout</strong>
      </div>
      <button id="checkoutBtn" class="button">Secure checkout</button>
      <p class="fineprint">Checkout is handled securely by Stripe.</p>
    </div>
  </dialog>

  <script src="/assets/app.js"></script>

  <!-- PDP behavior: pulls badge/title/description/price/highlights/includes/faq from products.json -->
  <script>
    (function () {
      const main = document.getElementById("galleryMain");
      const thumbs = document.getElementById("thumbs");

      const badgeHost = document.getElementById("pdpBadge");
      const titleEl = document.getElementById("pdpTitle");
      const descEl = document.getElementById("pdpDesc");
      const priceEl = document.getElementById("pdpPrice");
      const highlightsEl = document.getElementById("pdpHighlights");
      const includesEl = document.getElementById("pdpIncludes");
      const faqEl = document.getElementById("pdpFaq");

      const addBtn = document.getElementById("pdpAddToCart");
      const buyNowBtn = document.getElementById("pdpBuyNow");

      function esc(s) {
        return String(s ?? "").replace(/[&<>"']/g, (m) => ({
          "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
        }[m]));
      }

      function openCart() {
        const dlg = document.getElementById("cartDialog");
        if (dlg && typeof dlg.showModal === "function") dlg.showModal();
        if (typeof window.renderCart === "function") window.renderCart();
      }

      function setMain(src, alt) {
        if (!main) return;
        const img = new Image();
        img.onload = () => {
          main.innerHTML = "";
          img.alt = alt || "complexfour device";
          main.appendChild(img);
        };
        img.onerror = () => {};
        img.src = src;
      }

      function getCurrency() {
        const sel = document.getElementById("currencySelect");
        return sel ? sel.value : (window.currency || "GBP");
      }

      function getProduct() {
        const ps = window.products;
        if (Array.isArray(ps) && ps.length) return ps[0];
        return null;
      }

      function updatePrice(p) {
        const cur = getCurrency();
        const display = p?.price_display?.[cur];
        if (priceEl) priceEl.textContent = display || "Shown at checkout";
      }

      function renderBadge(p) {
        if (!badgeHost) return;
        badgeHost.innerHTML = p?.badge ? `<div class="badge">${esc(p.badge)}</div>` : "";
      }

      function renderHighlights(p) {
        if (!highlightsEl) return;
        const items = Array.isArray(p?.highlights) ? p.highlights : [];
        if (!items.length) return;
        highlightsEl.innerHTML = items.map(h => `<li>${esc(h)}</li>`).join("");
      }

      function renderIncludes(p) {
        if (!includesEl) return;
        const items = Array.isArray(p?.includes) ? p.includes : [];
        if (!items.length) return;
        includesEl.innerHTML = items.map(x => `<li>${esc(x)}</li>`).join("");
      }

      function renderFaq(p) {
        if (!faqEl) return;
        const items = Array.isArray(p?.faq) ? p.faq : [];
        if (!items.length) return;

        faqEl.innerHTML = items.map(item => `
          <p><strong>${esc(item.q)}</strong><br/>${esc(item.a)}</p>
        `).join("");
      }

      function wireButtons(p) {
        addBtn && addBtn.addEventListener("click", () => {
          if (typeof window.addToCart === "function") window.addToCart(p.id);
          openCart();
        });

        buyNowBtn && buyNowBtn.addEventListener("click", async () => {
          try {
            if (typeof window.addToCart === "function") window.addToCart(p.id);
            if (typeof window.checkout === "function") await window.checkout();
            else openCart();
          } catch (err) {
            alert(err?.message || "Checkout failed");
          }
        });
      }

      function wireGallery(p) {
        const defaultSrc = p?.image_url || "/assets/device.jpg";
        setMain(defaultSrc, p?.name || "complexfour device");

        if (thumbs) {
          thumbs.addEventListener("click", (e) => {
            const btn = e.target.closest(".thumb");
            if (!btn) return;
            [...thumbs.querySelectorAll(".thumb")].forEach(t => t.classList.remove("active"));
            btn.classList.add("active");
            const src = btn.getAttribute("data-src");
            if (src) setMain(src, p?.name);
          });
        }
      }

      // Wait for app.js init() to load products.json and expose window.products
      let tries = 0;
      const timer = setInterval(() => {
        tries++;
        const p = getProduct();
        if (p) {
          clearInterval(timer);

          // Fill PDP from JSON
          if (titleEl && p.name) titleEl.textContent = p.name;
          if (descEl && p.description) descEl.textContent = p.description;

          renderBadge(p);
          renderHighlights(p);
          renderIncludes(p);
          renderFaq(p);

          updatePrice(p);
          wireButtons(p);
          wireGallery(p);

          // Update price when currency changes
          const currencySelect = document.getElementById("currencySelect");
          if (currencySelect) currencySelect.addEventListener("change", () => updatePrice(p));
        } else if (tries > 80) {
          clearInterval(timer);
          if (priceEl) priceEl.textContent = "Shown at checkout";
        }
      }, 50);
    })();
  </script>

  <footer class="footer">
    <div class="container footer-inner">
      <div>
        <strong>complexfour</strong><br/>
        <span class="muted">Wellness equipment & education.</span>
      </div>
      <div class="footer-links">
        <a href="/products.html">Buy The Device</a>
        <a href="/about-hydrogen.html">About Hydrogen Inhalation</a>
        <a href="/about-complex-four.html">About Complex Four</a>
        <a href="/support.html">Support</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
      </div>
    </div>
  </footer>
</body>
</html>
